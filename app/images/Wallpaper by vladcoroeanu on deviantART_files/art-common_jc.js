/*
 *  (c) 2000-2014 deviantART, Inc. All rights reserved.
 */
window.Task=function(t,s){"object"==typeof t&&t.TASK instanceof Array?(this.f=t.TASK[0],s=t.TASK[1],this.f_args=t.TASK.slice(2)):"function"==typeof t?(this.f=t,this.f_args=Task.argSlice(arguments,2)):s=t,this.owner=s||Task.master_owner,this.listeners=[],this.reset(),this.clearHistory(),this.history_limit=Task.DEFAULT_HISTORY_LIMIT,this.station_end=[this.wait_f,this]},Task.argSlice=function(t,s){var i,n;for(n=[],i=s||0;t.length>i;i++)n.push(t[i]);return n},Task.master_owner=Task,Task.DEFAULT_HISTORY_LIMIT=10,Task.prototype={reset:function(){this.status={}},clearHistory:function(){this.history={}},listen:function(t,s){return this.listeners.push({f:t,f_this:s,f_args:Task.argSlice(arguments,2)}),this.cc_shout(this.listeners.length-1),this.listeners.length-1},listenOnce:function(t,s){this.listeners.push({f:t,f_this:s,f_args:Task.argSlice(arguments,2),expires:!0}),this.cc_shout(this.listeners.length-1)},nullListen:function(t){this.listeners[t]=null},report:function(t,s){void 0!=t&&null!=t&&(this.status.progress=t),void 0!=s&&null!=s&&(this.status.eta=s)},milestone:function(t){"complete"==t&&(this.status.result=arguments[1]),this.status.milestone=t,this.history[t]?this.history[t].length>this.history_limit&&this.history[t].pop():this.history[t]=[],this.history[t].unshift(Task.argSlice(arguments,1)),this.cc_shout()},done:function(t){this.milestone("complete",t)},abort:function(){this.reset()},cbDiFi:function(t,s){return this.owner&&this.owner._KP_dead?(this.off(),void 0):t?this.done(s.response.content):this.abort(s.response.content)},cbRawDiFi:function(t,s){return t?this.done(s):this.abort(s)},wait:function(){var t;t=Task.argSlice(arguments,0),t.push([this.wait_f,this]),Task.station.apply(Task.station,t)},wait_f:function(){this.done.apply(this,Task.station.data)},waitB:function(){var t;t=Task.argSlice(arguments,0),t.push([this.waitB_f,this]),Task.station.apply(Task.station,t)},waitB_f:function(){this.done.apply(this,Task.station.data.reverse())},cc_shout:function(t){var s,i,n;if(void 0!=this.status.milestone)for(i=[this.status.milestone,this.history[this.status.milestone]].concat(this.history[this.status.milestone][0]),s=t||0;s!=this.listeners.length&&(n=this.listeners[s],!n||(1==n.expires&&this.nullListen(s),n.f instanceof Task?n.f.milestone.apply(n.f_this||n.f,i.concat(n.f_args)):n.f.TASK_filter?n.f.TASK_filter==this.status.milestone&&n.f.apply(n.f_this,i.slice(1).concat(n.f_args)):n.f.apply(n.f_this,i.concat(n.f_args)),void 0==t));s++);},run:function(){var t,s;if(this.status.active===!0)return 0;if(2==this.status.active){for(t=0;this.needs[t];t++)if(!("result"in this.needs[t].status))return 0;this.f_args=this.f_args.concat(Task.station.data.reverse()),this.status.active=!0}else if(this.status.active=!0,this.needs&&this.needs.length)return this.status.active=2,Task.station.apply(Task.station,this.needs.concat(this)),1;return this.f&&(s=this.f.apply(this.owner,[this].concat(this.f_args,Task.argSlice(arguments,0)))),void 0==s?1:s},stop:function(){},retry:function(){return this.reset(),this.run.apply(this,arguments)},off:function(){this.milestone("shutdown"),this.listeners=[],Task.destroy(this)}},Task.station=function(t){var s,i,n;if("object"==typeof this&&this.data&&this.milestones)n=this;else{if(0==arguments.length)return;n={data:[],milestones:[]},"object"==typeof this&&(n.owner=this,n.owner_index=GUID.get(),n.owner.owns_stations[n.owner_index]=n)}for(i=[],s=1;arguments.length>s;s++)i.push(arguments[s]);for(;t instanceof Array;){if(n.milestones.unshift("function_call"),n.data.unshift(t[0].apply(t[1],t.slice(2))),Task.station.milestones=n.milestones,Task.station.data=n.data,!i.length||0==n.owner)return n.owner&&(delete n.owner.owns_stations[n.owner_index],n={}),void 0;t=i.shift()}0!=n.owner&&(t.listenOnce.apply(t,[Task.station_next,n].concat(i)),t.run())},Task.station_next=function(t,s,i,n){var e,a,o,r;if("string"==typeof n?(o=4,r=n):(o=3,r="complete"),t==r){for(this.milestones.unshift(t),this.data.unshift(i),Task.station.milestones=this.milestones,Task.station.data=this.data,a=[],e=o;arguments.length>e;e++)a.push(arguments[e]);a.length?Task.station.apply(this,a):s.owner&&(delete this.owner.owns_stations[this.owner_index],this.owner=null)}},Task.station.milestones=[],Task.station.data=[],Task.destroy=function(t){delete t},Task.DiFi=function(t,s){return task=new Task(Task.DiFiHelp,s),t.apply(DiFi,Task.argSlice(arguments,2).concat(task.cbDiFi,task)),task},Task.DiFiHelp=function(){DiFi.timer(1)},Task.Ani=function(t){return new Task(Task._AniHelp,t,Task.argSlice(arguments,1))},Task._AniHelp=function(t,s){Station.push.apply(Station,s.concat(bind(t,t.done)))},Task.Delay=Task.Yield=function(t){return new Task(Task._DelayHelp,null,t||1)},Task._DelayHelp=function(t,s){setTimeout(bind(t,t.done,null),s)},window.DWait&&DWait.run("jms/lib/task.js");
window.TakeOver=function(e,a,r){return f2=Function("var r;if (arguments.callee._takeover_f1)arguments.callee._takeover_f1.apply(this, arguments); r = arguments.callee._takeover_f2.apply(this, arguments); if (arguments.callee._takeover_f3)arguments.callee._takeover_f3.apply(this, arguments); return r;"),f2._takeover_f1=e,f2._takeover_f2=a,f2._takeover_f3=r,f2},window.DWait&&DWait.run("jms/lib/takeover.js");
function Refunction(n,e){var t,u,r;if(t=Refunction.get(n,e),!t){for(t=Function("return arguments.callee._refunction_f.apply(arguments.callee._refunction_obj, arguments.callee._refunction_args || arguments)"),t._refunction_obj=n,t._refunction_f=e,r=[],u=2;arguments.length>u;u++)r.push(arguments[u]);if(r.length&&(t._refunction_args=r),r.length||"run once"==this)return t;Refunction.lookup.push([n,e,t])}return t}Refunction.runOnce=function(n,e){return Refunction.call("run once",n,e)},Refunction.lastCall=function(n,e){return Refunction.get(n,e,!0)},Refunction.get=function(n,e,t){var u,r;for(u=0;r=Refunction.lookup[u];u++)if(r[0]==n&&r[1]==e)return t&&Refunction.lookup.splice(u,1),r[2];return null},Refunction.timeout=function(n,e){var t;for(t=Function("return arguments.callee._refunction_f.apply(arguments.callee._refunction_obj, arguments.callee._refunction_args || arguments)"),t._refunction_obj=n,t._refunction_f=e,args=[],i=2;arguments.length>i;i++)args.push(arguments[i]);return args.length||"run once"==this?(t._refunction_args=args,t):void 0},Refunction.lookup=[],window.DWait&&DWait.run("jms/lib/refunction.js");
Keeper2={register:function(){},unregister:function(){},broadcaster_on:function(){Keeper2.broadcaster||(Keeper2.broadcaster=new Task)},master_on:function(){var targets,i,client,eax,storage_id,name;for(window.deviantART&&(Page=deviantART.pageData,Page.deviant=deviantART.deviant||{},Page.deviant.username||(Page.deviant.username="",Page.deviant.symbol="",Page.deviant.usericon=0)),targets=document.getElementsByTagName("keeper2"),i=0;targets[i];i++)if(name=targets[i].getAttribute("for"),window[name]){if(client=eval(name),"function"==typeof client){if(targets[i].parentNode.getAttribute("keeper_done"))continue;client=new client(targets[i].parentNode)}else client.on.call(client,targets[i].parentNode);storage_id=GUID.get(),Keeper2.keeper_index[storage_id]=client,targets[i].parentNode.setAttribute("keeperkeeper",storage_id+"")}},master_off:function(){for(x in Keeper2.keeper_index)Keeper2.keeper_index[x].off();Keeper2.keeper_index={}},deleteOne:function(e){var t;for(t in Keeper2.keeper_index)if(Keeper2.keeper_index[t]==e){Keeper2.keeper_index[t].off(),delete Keeper2.keeper_index[t];break}},keeper_index:{},fromNode:function(e){var t;return t=e.getAttribute("keeperkeeper"),t?this.keeper_index[t]:null},get:function(e,t){"string"!=typeof e&&(t=e,e=null);do if(t.getAttribute("keeperkeeper"))return Keeper2.fromNode(t);while((t=t.parentNode)&&9!=t.nodeType);return null},classRegistry:{},getClass:function(lookup){return Keeper2.classRegistry[lookup]||eval(lookup)},make:function(e,t,r){var n,i,s,o,a,_;o="function"==typeof e?e:Keeper2.getClass(e),Keeper2.infect(o.prototype),n=new o(Function()),r=r||{};for(i in r)if("function"==typeof r[i]&&n[i])n[i]=TakeOver("off"==i?r[i]:null,n[i],"off"==i?null:r[i]);else if("spawnHooks"==i)for(n[i]||(n[i]=[]),s=0;r[i][s];s++)n[i].push(r[i][s]);else if("nodeMap"==i||"taskMap"==i||"modeMap"==i||"propMap"==i||"mutations"==i){n[i]||(n[i]={});for(s in r[i])n[i][s]=r[i][s]}else"template"==i||(n[i]=r[i]);return(r.template||n.template)&&(_=$(r.template||n.template)[0],a=GUID.get(),Keeper2.keeper_index[a]=n,_.setAttribute("keeperkeeper",a+""),n.node=_),n.owner=t,t._KP_owns.push(n),n._KP_owner_index=t._KP_owns.length-1,n.on(),n},megaGet:function(e,t,r,n){var i,s,o,a,_;if(t||(t=e.getAttribute("keeper")),i=Keeper2.fromNode(e),!i){if(a=Keeper2.getClass(t),a.prototype._KP_on||Keeper2.infect(a.prototype),i=new a(Function()),_=GUID.get(),Keeper2.keeper_index[_]=i,e.setAttribute("keeperkeeper",_+""),i.node=e,i.owner=r,r._KP_owns.push(i),i._KP_owner_index=r._KP_owns.length-2,n)for(s in n)if("function"==typeof n[s]&&i[s])i[s]=TakeOver("off"==s?n[s]:null,i[s],"off"==s?null:n[s]);else if("nodeMap"==s||"taskMap"==s||"modeMap"==s||"propMap"==s||"stuff"==s)for(o in extras[s])i[s][o]=n[s][o];else i[s]=n[s];i.on()}return i},registerClass:function(e,t){Keeper2.classRegistry[e]=t},infect:function(e){var t;if(e._KP_on)return!1;for(t in Keeper2.infection)e[t]=Keeper2.infection[t];e.on=TakeOver(e._KP_on,e.on,e._KP_start),e.off=TakeOver(null,e.off,e._KP_off)},infection:{_KP_on:function(){var e,t,r;if(this._KP_dead=!1,this.guid=GUID.get(),this.constructor._KP_mc||(this.constructor._KP_mc={}),this._KP_owns=[],this.owns_stations={},this._KP_node_cache={},this._KP_prop_cache={},this._KP_task_cache={},this._KP_peekers={},this.receiver&&(this.receiver.TASK_filter="broadcast",Keeper2.broadcaster_on(),this._KP_receiver=Keeper2.broadcaster.listen(this.receiver,this)),this.propMap){r=this.propMap;for(e in r)if(r[e].watches_props)for(t in r[e].watches_props)this.watchProp(t,r[e].watches_props[t])}},_KP_start:function(){if(this.nodeMap)for(items=this._KP_getByRenderFlag(KEEPER_RENDER_IMMEDIATE,this.nodeMap),i=0;items[i];i++)this.getNode(items[i]);if(this.propMap)for(items=this._KP_getByRenderFlag(KEEPER_RENDER_IMMEDIATE,this.propMap),i=0;items[i];i++)this.getProp(items[i])},_KP_off:function(){var e;for(e=0;e!=this._KP_owns.length;e++)this._KP_owns[e]&&(this._KP_owns[e].off(),this._KP_owns[e]=null);for(e in this.owns_stations)this.owns_stations[e].owner=0,delete this.owns_stations[e];for(e in this.prop_cache)this.prop_cache[e].off(),delete this.prop_cache[e];this._KP_receiver&&Keeper2.broadcaster.nullListen(this._KP_receiver),this.node&&(delete Keeper2.keeper_index[this.node.getAttribute("keeperkeeper")],this.node.setAttribute("keeperkeeper",""),this.node.removeAttribute("keeperkeeper"),this.node.parentNode&&!this._KP_keep_node&&this.node.parentNode.removeChild(this.node)),this._KP_owner_index>=0&&(this.owner._KP_owns[this._KP_owner_index]=null),this._KP_dead=!0},_KP_gets:function(e){var t,r;for(r=[],t=0;t!=this._KP_owns.length;t++)this._KP_owns[t]&&this._KP_owns[t]instanceof e&&r.push(this._KP_owns[t]);return r},_KP_clear:function(e){var t;if("string"==typeof e)$(e,this.node).remove();else for(t=0;t!=this._KP_owns.length;t++)this._KP_owns[t]&&(!e||this._KP_owns[t]instanceof e)&&(this._KP_owns[t].off(),this._KP_owns[t]=null)},_KP_getByRenderFlag:function(e,t){var r,n;n=[];for(r in t)t[r].render==e&&n.push(r);return n},reboot:function(e,t){setTimeout(Refunction(Keeper2,Keeper2.rebootAssistant,this.owner,this.node.parentNode,this.node.nextSibling,e,t),10),this.off()},spawn:function(e,t){var r;if(this.spawnHooks)for(r=0;this.spawnHooks[r];r++)t=this.spawnHooks[r].call(this,e,t||{});return Keeper2.make(e,this,t)},broadcast:function(){Keeper2.broadcaster_on(),Keeper2.broadcaster.milestone.apply(Keeper2.broadcaster,["broadcast",this].concat(Task.argSlice(arguments))),Keeper2.broadcaster.reset()},mc:function(e,t){return e?(void 0!==t&&(null==t?delete this.constructor._KP_mc[e]:this.constructor._KP_mc[e]=t),this.constructor._KP_mc[e]):this.constructor._KP_mc},get:function(){this.peek.apply(this,arguments).run()},peek:function(){var e,t,r,n,i,s,o,a;if(this.stuff){for(s=[],t=this.stuff,e=0;e!=arguments.length;e++){switch(typeof arguments[e]){case"function":for(t=this.owner;!(t instanceof arguments[e])&&t;)t=t.owner;return arguments.callee.apply(t,Task.argSlice(arguments,e+1));case"object":return arguments[e].stuff?arguments.callee.apply(arguments[e],Task.argSlice(arguments,e+1)):null;case"string":if(s.push(arguments[e]),t[arguments[e]]){if(t=t[arguments[e]],t.get||t.think){e++,a=!0;break}break}return null;default:return null}if(a)break}if(s=s.join("/"),o=this._KP_peekers[s]?this._KP_peekers[s]:this._KP_peekers[s]={},t.get){if(n=[],t.parameters&&!o.parameter_hooked){for(e=0;t.parameters[e];e++)this.watchProp(t.parameters[e],Refunction(this,this._KP_paramKill,o));o.parameter_hooked=!0}if(o.get_cached)return o.get_cached;if(t.parameters)for(e=0;t.parameters[e];e++)n.push(this.getProp(t.parameters[e]));i=t.get}else i=t.think,n=Task.argSlice(arguments,e);if(i.ebx=t,r=new Task({TASK:[i,this].concat(n)}),t.needs)for(r.needs=[],"string"==typeof t.needs[0]&&(t.needs[0]=[t.needs[0]]),e=0;t.needs[e];e++)r.needs.push(this.peek.apply(this,t.needs[e]));return t.get&&(o.get_cached=r),r}},_KP_paramKill:function(e){e.get_cached=null},_KP_mainTask:function(e){e.wait(this.needs)},_KP_lastTask:function(e){this.call.apply(this.that,[e].concat(Task.station.data.reverse()).concat(this.params))},getNode:function(e){var t,r,n,i,s;if(n=e,void 0==(i=this._KP_node_cache[n])){if(s=(this.nodeMap||{})[e]||{},t=s.get||this._KP_defaultGetNodeMethod,(i=t.call(this,e)||null)&&((this.nodeMap||{})[e]&&(this.nodeMap||{})[e].renderCall&&(this.nodeMap||{})[e].renderCall.call(this,e,i),s.watches_props)){if(s.invalidate==KEEPER_INVALIDATE_ALWAYS)throw Error("No watch_props on non-caching nodes");for(r in s.watches_props)this.watchProp(r,s.watches_props[r])}s.invalidate!=KEEPER_INVALIDATE_ALWAYS&&(this._KP_node_cache[n]=i)}return i},_KP_defaultGetNodeMethod:function(e){return $("*."+e,this.node)[0]},uiPut:function(e,t,r){var n;if(n=this.getNode(e),void 0==t&&void 0==r||"string"==typeof r||"string"==typeof t)if(r)n.innerHTML=r;else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild((this.node.ownerDocument||this.node.document).createTextNode(t))}else{for(;n.firstChild;)n.removeChild(n.firstChild);n.appendChild(t)}},mode:function(e,t,r){var n,i,s;return this._KP_current_modes||(this._KP_current_modes={}),n=this.modeMap[e],i="string"==typeof this._KP_current_modes[e]?this._KP_current_modes[e]:"default",void 0==t?"default"==i?"":i:(t=t||"default",t==i&!r||(s=i+" to "+t,n[s]?n[s].call(this,i,t):(n[i]&&n[i].off&&n[i].off.call(this),n[t]&&n[t].on&&n[t].on.call(this,i,t)),this._KP_current_modes[e]=t),void 0)},getTask:function(e){return this._KP_task_cache[e]||(this._KP_task_cache[e]=new Task(this.taskMap[e],this,e)),this._KP_task_cache[e]},getPropHistory:function(e){return this._KP_getPropTask(e).history.data||[]},_KP_getPropTask:function(e){return this._KP_prop_cache[e]||(this._KP_prop_cache[e]=new Task(this._KP_tasker_for_getProp,this,e),this.propMap[e].change&&this.watchProp(e,this.propMap[e].change)),this._KP_prop_cache[e]},_KP_tasker_for_getProp:function(e,t,r){var n;n=this.propMap[t].get.call(this,t),e.history.data&&e.history.data[0]&&e.history.data[0][0]==n||e.milestone("data",n,r,t)},getProp:function(e){var t,r;return t=this.propMap[e].invalidate==KEEPER_INVALIDATE_ALWAYS,r=this._KP_getPropTask(e),("data"!=r.status.milestone||t)&&(r.run("get")||r.retry("get")),r.history.data[0][0]},setProp:function(e,t,r){var n;n=this._KP_getPropTask(e),n.history.data&&n.history.data[0]&&n.history.data[0][0]==t||n.milestone("data",t,r||"set",e)},invalidateProp:function(e){var t;t=this._KP_getPropTask(e),t.reset(),t.listeners.length>0&&setTimeout(Refunction(t,t.run,"invalidate"),1)},watchProp:function(e,t,r){var n;return t.TASK_filter="data",n=this._KP_getPropTask(e),n.listen(t,r||this,e)},unwatchProp:function(e,t){return this._KP_getPropTask(e).nullListen(t)},up:function(e,t){var r;for(r=this,t=t||0;r=r.owner;)if(r instanceof e){if(0==t)return r;t--}return null}},rebootAssistant:function(e,t,r,n,i){$(e.spawn(n,i).node).insertBefore(r)}},DWait.ready("jms/lib/jquery/jquery.current.js",function(){$(Keeper2.master_on)}),KEEPER_RENDER_PRERENDERED=0,KEEPER_RENDER_IMMEDIATE=1,KEEPER_RENDER_ONSCROLL=2,KEEPER_RENDER_TEMPLATE=4,KEEPER_INVALIDATE_MANUAL=0,KEEPER_INVALIDATE_ALWAYS=1,window.DWait&&DWait.run("jms/lib/keeper2.js");
window.App=function(){this.node=document.documentElement,Keeper2.infect(this),this.on()},App.startup=[],App.prototype={debug_label:"App",on:function(){this._KP_keep_node=!0},off:function(){},stuff:{data:{}}},App.startup=function(){var targets,i,client,eax,storage_id;for(App.instance=new App,window.deviantART&&!window.Page&&(Page=deviantART.pageData,Page.deviant=deviantART.deviant||{},Page.deviant.username||(Page.deviant.username="",Page.deviant.symbol="",Page.deviant.usericon=0)),targets=document.getElementsByTagName("keeper3"),i=0;targets[i];i++)client=eval(targets[i].getAttribute("for")),client=App.instance.spawn(client,{node:targets[i].parentNode,domData:targets[i],_KP_keep_node:!0}),storage_id=GUID.get(),Keeper2.keeper_index[storage_id]=client,client.node.setAttribute("keeperkeeper",storage_id+"")},App.bios=function(){if(Browser.isIE)try{document.documentElement.doScroll("left")}catch(e){return setTimeout(arguments.callee,50),void 0}App.startup()},App.COMMENTS_PER_PAGE=25,DWait.ready(".domready",App.bios),window.DWait&&DWait.run("jms/lib/app.js");
App.prototype.stuff.data.moods={get:function(i){i.wait(Task.DiFi(DiFi.pushPublicGet,this,"Mood","getMoodsFlattened",[])),DiFi.timer(1)}},window.DWait&&DWait.run("jms/lib/app.js.moods.js");
COMMENT_DEVIATION=1,COMMENT_GALLERIES=20,COMMENT_FAVCOLLECTIONS=21,App.prototype.stuff.data["resource views by rid"]={think:function(e,r,s,o){var i,c,t,p,u,a,n,_;App.resources_by_rid_cache||(App.resources_by_rid_cache={}),p=!1,c=[],t={},_=[];for(i in o)_.push(i+":"+Number(o[i]));for(_.sort(),_=_.join(","),n=[],i=0;r.length>i;i++)u=r[i],u&&(a=u[0]+":"+u[1]+":"+s+":"+_,n.push(a),t[a]||0!=App.resources_by_rid_cache[a]&&void 0!==App.resources_by_rid_cache[a]||(t[a]=1,App.resources_by_rid_cache[a]=0,c.push(new Task),p=!0,DiFi.pushPublicGet("Resources","htmlFromRID",[u[0],u[1],s,_],arguments.callee.ebx.rackitup,c[c.length-1])));Browser.isKHTML&&!Browser.isSafari&&c.push(Task.Delay(1)),c.push([function(r){var s;for(s=[],i=0;r[i];i++)App.resources_by_rid_cache[r[i]]&&s.push(App.resources_by_rid_cache[r[i]]);e.done(s)},this,n.slice(0)]),Task.station.apply(Task.station,c),p&&DiFi.timer(90)},rackitup:function(e,r){var s;return e?(s=r.request.args.join(":"),App.resources_by_rid_cache[s]=r.response.content,this.done(),void 0):(this.abort(r.response.content),void 0)}},App.prototype.stuff.data["resource views by query"]={think:function(e,r,s,o,i,c){var t,p;p=[];for(t in c)p.push(t+":"+Number(c[t]));p.sort(),p=p.join(","),DiFi.pushPublicGet("Resources","htmlFromQuery",[r,s,o,i,p],arguments.callee.ebx.rackitup,e),DiFi.timer(1)},rackitup:function(e,r){var s,o,i;if(e){for(App.resources_by_rid_cache||(App.resources_by_rid_cache={}),i=[],s=0;o=r.response.content.resources[s];s++)App.resources_by_rid_cache[o[0]+":"+o[1]+":"+r.request.args[3]+":"+r.request.args[4]]=o[2],i.push(o[2]);this.done({total:r.response.content.total,more:r.response.content.more,resources:i})}else this.abort()}},App.cacheResourceView=function(e,r,s,o,i){var c,t,p;if("string"==typeof o)p=o;else{p=[];for(t in o)p.push(t+":"+Number(o[t]));p.sort(),p=p.join(",")}return c=e+":"+r+":"+s+":"+p,App.resources_by_rid_cache||(App.resources_by_rid_cache={}),void 0===i?App.resources_by_rid_cache[c]:(App.resources_by_rid_cache[c]=i,void 0)},window.DWait&&DWait.run("jms/lib/app.js.deviations.js");
PHP={$GLOBALS:{urls:{avatarurl:"http://a.deviantart.net/avatars"},symbols:{"+":{userclass:"admin",description:"deviantART Staff"},$:{userclass:"admin",description:"deviantART Staff"},"@":{userclass:"admin",description:"deviantART Staff"},"¢":{userclass:"admin",description:"deviantART Staff"},"£":{userclass:"admin",description:"deviantART Staff"},"*":{userclass:"premium",description:"Premium Member"},".":{userclass:"hell",description:"Premium Member 'til Hell Freezes Over"},"=":{userclass:"beta",description:"Beta Tester"},":":{userclass:"hell-beta",description:"Beta Tester 'til Hell Freezes Over"},"°":{userclass:"senior",description:"Senior Member"},"`":{userclass:"senior",description:"Senior Member"},"^":{userclass:"volunteer",description:"Volunteer"},"!":{userclass:"banned",description:"Banned or Deactivated/Closed Account"},"#":{userclass:"group",description:"Group",clickthrough:"http://groups.deviantart.com"},"%":{userclass:"super group",description:"Super Group",clickthrough:"http://groups.deviantart.com"},"~":{userclass:"regular",description:""},"-":{userclass:"banned",description:""}},safedomains:["deviantart.com","dreamup.com","sta.sh","fav.me"]},image_type_to_extension:function(e,s){var r,t=1,i=2,a=3;if(e=Number(e),void 0===s&&(s=!0),!e)return!1;switch(r=s?".":"",e){case t:return r+"gif";case i:return r+"jpg";case a:return r+"png";default:return r+e}},subdirize:function(e,s,r){var t,i,a;if(void 0===s&&(s=3),void 0===r&&(r=!1),t=e,s>e.length&&(s=e.length),i=e.indexOf("."),i>0&&s>i&&(s=i),1>s)return!1;for(e=e.replace(/[^A-Za-z0-9]/g,"_"),a="",r&&(e=strrev(e)),$i=0;s>$i;$i++)a+=e.substr($i,1)+"/";return a+=t},userurl:function(e){return"http://"+e.toLowerCase()+".deviantart.com"},userlink:function(e,s,r,t,i){void 0===s&&(s="~");var a,n=PHP.$GLOBALS.symbols[s]?PHP.$GLOBALS.symbols[s]:PHP.$GLOBALS.symbols["~"];return void 0===r&&(r="/"),("!"===s||"-"===s)&&(t=!0),"object"==typeof e?(s=e.symbol,e=e.username):"number"==typeof e&&(e=""+e),e?(("~"==s||"-"==s)&&(i=!1),s='<span class="user-symbol '+n.userclass+'"'+'data-quicktip-text="'+n.description+'"'+'data-gruser-type="'+n.userclass+'"'+(i===!0?"onmouseover=\"if (window.QuickTip)QuickTip.show(this, 'simple')\"":"")+"></span>",t?'<span class="username-with-symbol u"><span class="'+n.userclass+' username">'+e+"</span>"+s+"</span>":(a='<span class="username-with-symbol u"><a class="username" href="'+PHP.userurl(e)+r+'">'+e+"</a>",s&&(a+=s),a+="</span>")):"<em>Nobody</em>"},usericon:function(e,s,r,t){var i;return void 0===s&&(s=1),void 0===r&&(r=!1),void 0===t&&(t=!1),e=e.toLowerCase(),i=t?' style="float:left; padding-right: 2px; padding-bottom: 2px;"':"",'<a href="'+PHP.userurl(e)+'/"><img class="avatar"'+i+' src="'+PHP.usericonurl(e,s)+'" width="50" height="50" alt="'+":icon"+e+":"+'" title="'+e+'"/></a>'},usericonlink:function(e,s,r){var t;return void 0===r&&(r=1),t=PHP.userlink(e,s),t=t.replace("</a>",'<img class="avatar" src="'+PHP.usericonurl(e,r)+'" width="50" height="50" alt=":icon'+e+':"/></a>')},usericonurl:function(e,s){var r;return void 0===s&&(s=1),$cachebuster=15&s>>2,r=s?PHP.subdirize(e.toLowerCase(),2)+PHP.image_type_to_extension(3&s):"default.gif",$cachebuster&&(r+="?"+$cachebuster),PHP.$GLOBALS.urls.avatarurl+"/"+r},isSafeURL:function(e){var s=window.PHP.$GLOBALS.safedomains;return/^mailto:/.test(e)?!0:/deviantart\.com\/users\/outgoing/.test(e)||!/https?:\/\//.test(e)?!1:RegExp("\\.("+s.join("|").replace(/\./g,"\\.")+")$").test("."+e.split("/")[2])}},window.DWait&&DWait.run("jms/lib/php.js");
window.pluralize=function(e,t,r){return(e?e:"no")+" "+t+(1==e?"":r||"s")},window.htmlspecialchars=function(e){return e.replace(/\&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},window.time_string=function(e,t){var r,n,a,u,s,o,i,l,g,m,h,p;if(!Number(e))return"";if(n={minutes:6e4,hours:36e5,days:864e5,weeks:6048e5,months:26298e5,years:315576e5},s=new Date,s.setTime(1e3*Number(e)),u=new Date,m=u.valueOf()-s.valueOf(),0>m)return"Moments ago";m>3*n.days&&(p=!0),r=["January","February","March","April","May","June","July","August","September","October","November","December"],a=["th","st","nd","rd","th"],o=s.getDate(),h=r[s.getMonth()].substr(0,3)+" "+o+", "+s.getFullYear()+", "+(s.getHours()%12||12)+":"+(s.getMinutes()>=10?"":"0")+s.getMinutes()+" "+(12>s.getHours()?"AM":"PM"),i=[];for(g in n)m>n[g]&&i.push(g);if(0==i.length)return"Moments ago";for(i=i.slice(Math.max(i.length-(t||2),0)),l=[];g=i.pop();)o=Math.floor(m/n[g]),m%=n[g],o>0&&l.push(o+" "+(1==o?g.substr(g,g.length-1):g));return l=l.join(", ")+" ago",'<span title="'+(p?l:h)+'">'+(p?h:l)+"</span>"},window.DWait&&DWait.run("jms/lib/formatting.js");if(window.DWait){DWait.count()}