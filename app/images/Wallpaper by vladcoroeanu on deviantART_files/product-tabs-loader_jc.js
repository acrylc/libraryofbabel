/*
 *  (c) 2000-2013 deviantART, Inc. All rights reserved.
 */
DWait.ready(["cssms/shop/product_tabs_min.css","jms/lib/pubsub.js","jms/lib/Base.js","jms/lib/jquery/jquery.current.js",".domready"],function(){(function(){var t=Base.extend({current_print_id:0,_parts_needed:["tabs","preview"],_parts_loaded_by_printid:{},_print_ids_open:{},handlers:{part_loaded:function(t,i){this.current_print_id in this._parts_loaded_by_printid||this._init_parts_loaded_by_printid(),this._part_loaded(i),this.is_loading_done()&&!this.is_open()&&(this._toggle_open(!0),$("#printtabscontainer.loading").addClass("disabled"),$("html,body").animate({scrollTop:40},500),PubSub.publish("ProductTabsLoader.loaded"))},tabs_closed:function(){PubSub.publish("DaGa.track_event",{category:"Deviation",action:"printtabs_closed"}),this._toggle_open(!1),this._init_parts_loaded_by_printid(),$(".dev-meta-producttabs #printtabscontainer").removeClass("loading disabled"),$("#print-button:visible, #buy-tabs:visible").removeClass("open"),this.reset_print_id()},tab_opener_clicked:function(t){var i=$(t.currentTarget),s=i.data("print-id"),r=i.data("content-id");this.is_open(s)||(this.current_print_id=s,i.closest("#printtabscontainer").addClass("loading"),this._load(s,r))},duperbrowse_closed:function(){var t=$(".product-tab:visible").first(),i=t.data("print-id");i!=this.current_print_id&&(PubSub.publish("ProductTabsLoader.remove",this.current_print_id),this._toggle_open(!1),this._init_parts_loaded_by_printid(),t.hasClass("product-tab-active")?this.current_print_id=i:this.reset_print_id())}},constructor:function(){if(PubSub.subscribe([{eventname:"ProductTabsView.tabs_closed",subscriber:this,callback:this.handlers.tabs_closed},{eventname:"ProductTabsLoader.part_loaded",subscriber:this,callback:this.handlers.part_loaded},{eventname:"Duperbrowse.closed",subscriber:this,callback:this.handlers.duperbrowse_closed}]),$("#print").length){var t=$(".product-tabs:first").data("print-id");this._load(t)}else $(document).on("click.prodtabloader",".product-tabs-opener",this.handlers.tab_opener_clicked.bindTo(this))},is_loading_done:function(){var t,i=this._parts_loaded_by_printid[this.current_print_id];for(t in this._parts_needed)if(!i[this._parts_needed[t]])return!1;return this._init_parts_loaded_by_printid(),!0},is_open:function(t){return t=t||this.current_print_id,this._print_ids_open[t]},reset_print_id:function(){this.current_print_id=0},_load:function(t,i){var s={print_id:t,content_id:i};DWait.ready(["cssms/shop/product_tabs.css","cssms/shop/printshop.css","jms/shop/product-tabs-view.js","jms/shop/product-preview.js"],function(){PubSub.publish("ProductTabsLoader.load",s)})},_init_parts_loaded_by_printid:function(){var t,i={};for(t in this._parts_needed)i[this._parts_needed[t]]=!1;this._parts_loaded_by_printid[this.current_print_id]=i},_part_loaded:function(t){this._parts_loaded_by_printid[this.current_print_id][t]=!0},_toggle_open:function(t){this._print_ids_open[this.current_print_id]=t}});new t})(),window.DWait&&DWait.run("jms/shop/product-tabs-loader.js")});if(window.DWait){DWait.count()}